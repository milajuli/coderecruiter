<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <meta http-equiv="X-UA-Compatible" content="ie=edge">
  <title>coderecruiter</title>
  <link rel="stylesheet" href="./dist/assets/styles/register.css">
</head>

<body class="page-register">
  <div class="wrapper">
    <header class="header">
      <div class="container">
        <a class="header-logo" href="#">
          <img src="./dist/assets/images/logo.png" alt="">
        </a>
      </div>
    </header>
    <main class="main">
      <div class="container">
        <div class="form">
          <form>
            <div class="form-block">
              <div class="form-title">
                <h1>Register</h1>
                <h2>
                  Datos Personales!
                  <span>Por favor completa tus datos</span>
                </h2>
              </div>
              <div class="form-controls">
                <div class="row">
                  <div class="col col6">
                    <div class="form-row">
                      <label>Nombre</label>
                      <input required class="js_name form-input" type="text">
                    </div>
                  </div>
                  <div class="col col6">
                    <div class="form-row">
                      <label>Apellido</label>
                      <input required class="js_lastname form-input" type="text">
                    </div>
                  </div>
                </div>
                <div class="row">
                  <div class="col col6">
                    <div class="form-row">
                      <label>Telefono - Celular</label>
                      <input required class="js_phone form-input" type="text">
                    </div>
                  </div>
                  <div class="col col6">
                    <div class="form-row">
                      <label>Direccion</label>
                      <input required class="js_direction form-input" type="text">
                    </div>
                  </div>
                </div>
                <div class="row">
                  <div class="col col6">
                    <div class="form-row">
                      <label>Sexo</label>
                      <div class="row row-radio">
                        <div class="col">
                          <label>F
                            <input class="js_radio-a" required type="radio" checked name="sex">
                          </label>
                        </div>
                        <div class="col">
                          <label>M
                            <input class="js_radio-b" required type="radio" name="sex">
                          </label>
                        </div>
                      </div>
                    </div>
                  </div>
                </div>
                <div class="row">
                  <div class="col col6">
                    <div class="form-row">
                      <label>Usuario</label>
                      <input required class="js_user form-input" type="text">
                    </div>
                  </div>
                  <div class="col col6">
                    <div class="form-row">
                      <label>Contrase√±a</label>
                      <input required class="js_password form-input" type="password">
                    </div>
                  </div>
                </div>
                <div class="row">
                  <div class="col col6">
                    <div class="form-row">
                      <label>Correo Electronico</label>
                      <input required class="js_email form-input" type="email">
                    </div>
                  </div>
                  <div class="col col6">
                    <div class="form-row">
                      <label>Foto</label>
                      <input required class="js_file " type="file">
                    </div>
                  </div>
                </div>
              </div>
            </div>
            <div class="form-block">
              <div class="form-title">
                <h2>
                  Datos de la carrera
                  <span>Por favor completa tus datos</span>
                </h2>
              </div>
              <div class="form-controls">
                <div class="row">
                  <div class="col col6">
                    <div class="form-row">
                      <label>Especialidad</label>
                      <select required class="js_career form-select">
                        <option value="">Selecciona</option>
                        <option value="1">Front End</option>
                        <option value="2">Back End</option>
                        <option value="3">Full Stack</option>
                        <option value="4">Scrum Master</option>
                      </select>
                    </div>
                  </div>
                </div>
                <div class="row">
                  <div class="col col12">
                    <div class="form-row">
                      <label>Cuentanos sobre ti</label>
                      <textarea minlength="20" required class="js_about form-textarea" name="" id="" cols="30" rows="10">

                      </textarea>
                    </div>
                  </div>
                </div>
              </div>
            </div>
            <div class="form-block">
              <div class="form-title">
                <h2>
                  Redes Sociales
                  <span>Por favor completa tus datos</span>
                </h2>
              </div>
              <div class="form-controls">
                <div class="row">
                  <div class="col col12">
                    <div class="form-row">
                      <label>Facebook</label>
                      <input required class="js_fb form-input" type="text">
                    </div>
                  </div>
                </div>
                <div class="row">
                  <div class="col col12">
                    <div class="form-row">
                      <label>Twitter</label>
                      <input required class="js_tw form-input" type="text">
                    </div>
                  </div>
                </div>
                <div class="row">
                  <div class="col col12">
                    <div class="form-row">
                      <label>Github</label>
                      <input required class="js_git form-input" type="text">
                    </div>
                  </div>
                </div>
                <div class="row">
                  <div class="col col12">
                    <div class="form-row">
                      <label>Linkedin</label>
                      <input required class="js_link form-input" type="text">
                    </div>
                  </div>
                </div>
                <div class="row">
                  <div class="col col12">
                    <div class="form-row">
                      <label>Codepen</label>
                      <input required class="js_cod form-input" type="text">
                    </div>
                  </div>
                </div>
                <div class="row">
                  <div class="col col12">
                    <button type="submit" class="js_btn button button-primary">Registrar</button>
                  </div>
                </div>
              </div>
            </div>
          </form>
        </div>
    </main>
    <footer class="footer">
      <div class="container">
        <p>Todos los derechos reservados | 2019</p>
        <a href="" class="logo">
          <img width="80" height="19" src="./dist/assets/images/logo.png" alt="">
        </a>
      </div>
    </footer>
    </div>

    <script src="https://www.gstatic.com/firebasejs/5.9.2/firebase.js"></script>
    <script src="./dist/assets/scripts/firebaseKey.js"></script>
    <script>
      function getValues() {
        let name,
          lastname,
          cellphone,
          direction,
          sexF,
          sexM,
          user,
          password,
          email,
          career,
          about,
          fb,
          tw,
          git,
          link,
          cod,
          sex,
          picture;

        name = returnValue('.js_name');
        lastname = returnValue('.js_lastname');
        cellphone = returnValue('.js_phone');
        direction = returnValue('.js_direction');
        sexF = document.querySelector('.js_radio-a').checked;
        sexM = document.querySelector('.js_radio-b').checked;
        user = returnValue('.js_name');
        password = returnValue('.js_password');
        email = returnValue('.js_email');
        dateCareer = returnValue('.js_career');
        about = returnValue('.js_about');
        facebook = returnValue('.js_fb');
        twitter = returnValue('.js_tw');
        github = returnValue('.js_git');
        linkedin = returnValue('.js_link');
        codepen = returnValue('.js_cod');
        sex = (sexF) ? 'F' : 'M';
        picture = document.querySelector('.js_file').files[0].name;

        //values
        const infoPersonal = {
          about,
          cellphone,
          dateCareer: '',
          direction,
          lastname,
          name,
          sex,
          picture,
          social: {
            codepen,
            facebook,
            github,
            linkedin,
            twitter
          }
        };

        return {
          auth: {
            email,
            password
          },
          infoPersonal
        }
      }

      function returnValue(name) {
        return document.querySelector(name).value;
      }

      function registerInfoPersonal() {
        const db = firebase.firestore();
        const { infoPersonal } = getValues();

        db.collection("users").add(infoPersonal)
          .then(function (docRef) {
            //alert("La informacion se creo correctamente");
            document.querySelector('body').classList.remove('is-loading');
            setTimeout(function () {
              window.location.href = 'dashboard.html';
            }, 2000);
          })
          .catch(function (error) {
            console.error("Error adding document: ", error);
          });
      }

      function registerUser(email, password) {
        const { auth } = getValues();

        firebase.auth().createUserWithEmailAndPassword(auth.email, auth.password)
          .then(function (user) {
            registerInfoPersonal();
            firebase.auth().currentUser.sendEmailVerification().then(function (e) {
              console.log('email sent', e);
            }).catch(function (error) {
              // An error happened.
            });
          })
          .catch(function (error) {
            // Handle Errors here.
            var errorCode = error.code;
            var errorMessage = error.message;
            // ...
          });
      }

      // FIRE EVENT
      function submitForm(e) {
        e.preventDefault();
        registerUser();
        document.querySelector('body').classList.add('is-loading');
      }
      document.querySelector('form').addEventListener('submit', submitForm);
    </script>
</body>

</html>
